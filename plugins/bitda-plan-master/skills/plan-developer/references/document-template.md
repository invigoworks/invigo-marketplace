# 기획서 문서 템플릿 (기능 단위)

> **용도**: 상위 메뉴 전체를 다루는 기능 단위 기획서
> **페이지별 상세 기획**: `page-spec-template.md` 참조

## Final Document Structure

```markdown
# [기능명] 기획서

## 1. 개요

### 1.1 배경 (Background)
[이 기능이 필요한 비즈니스 배경]

### 1.2 목적 (Purpose)
[핵심 목표 1-2문장]

### 1.3 타겟 사용자 (Target Users)
| 사용자 유형 | 역할 코드 | 주요 사용 시나리오 |
|-------------|----------|-------------------|
| 시스템 관리자 | ADMIN | 전체 관리 |

### 1.4 예상 효과
- [ ] 효과 1

## 2. 주요 기능
### 2.1 [기능 1]
- 설명:
- 비즈니스 로직:
- 관련 화면:

### 2.2 [기능 2]
...

## 3. 화면 구성
### 3.1 [화면명] - [화면유형]
- 화면 코드: BITDA-XX-XX-XX-[S/F/P]001
- 진입 경로:
- shadcn 컴포넌트:
  - DataTable: 목록 표시
  - Sheet: 등록/수정 폼
  - Dialog: 확인 팝업
- 사용자 액션:
  - [액션명]: [동작 설명]

## 4. 데이터 요구사항
### 4.1 입력 데이터
| 필드명 | 타입 | 필수 | 유효성 검증 | shadcn 컴포넌트 |
|--------|------|------|-------------|-----------------|
| 제품명 | Text | ✓ | 최대 100자 | Input |
| 수량 | Number | ✓ | 양수 | Input type="number" |
| 날짜 | Date | ✓ | 미래 날짜 | DatePicker |

### 4.2 출력 데이터
| 필드명 | 타입 | 설명 |
|--------|------|------|

## 5. API 명세 (예상)

> 참고: `references/backend-architecture.md`의 헥사고날 아키텍처 패턴 적용

### 5.1 엔드포인트
| 엔드포인트 | 메서드 | 설명 | UseCase |
|------------|--------|------|---------|

### 5.2 Command/Query 구조
| 타입 | 클래스명 | 설명 |
|------|----------|------|

### 5.3 도메인 이벤트
| 이벤트 | 발생 시점 | 페이로드 |
|--------|----------|----------|

## 6. 에러 처리
| 상황 | 에러 메시지 | UI 피드백 (shadcn) |
|------|-------------|-------------------|
| 필수값 누락 | 필수 항목입니다 | FormMessage |
| 저장 실패 | 저장에 실패했습니다 | Toast (error) |

## 7. 인수 조건 (AC)

> Given-When-Then 형식으로 주요 시나리오 정의

### AC-1: [시나리오명]
```gherkin
Given: [전제 조건]
When: [사용자 액션]
Then: [예상 결과]
```

### AC-2: [시나리오명]
```gherkin
Given: [전제 조건]
When: [사용자 액션]
Then: [예상 결과]
```

## 8. 화면 흐름 (User Flow)

### 8.1 진입 경로
```
사이드바 > [상위 메뉴] > [하위 메뉴]
Route: /[앱]/[모듈]/[기능]
```

### 8.2 화면 내 흐름
```
[메인 화면]
    │
    ├─▶ [등록] 버튼 → Sheet (등록 폼)
    │       └─▶ [저장] → 목록 갱신
    │
    └─▶ [행 클릭] → Sheet (상세/수정)
            └─▶ [삭제] → 확인 Dialog
```

### 8.3 연결 화면 (Relations)
| 연결 방향 | 화면 코드 | 화면명 | 연결 방식 |
|----------|----------|--------|----------|
| FROM | - | - | 사이드바 |
| TO | XXX-S002 | 상세 페이지 | 행 클릭 |
| RELATED | YYY-F001 | 관련 폼 | 버튼 클릭 |

## 9. 권한 및 접근 제어

### 9.1 역할 기반 접근 (RBAC)
| 역할 | 조회 | 등록 | 수정 | 삭제 | 비고 |
|------|------|------|------|------|------|
| ADMIN | ✓ | ✓ | ✓ | ✓ | 전체 권한 |
| MANAGER | ✓ | ✓ | ✓ | ✗ | |
| USER | ✓ | ✗ | ✗ | ✗ | 조회만 |

### 9.2 권한 코드 (Permission Codes)
> 형식: `resource:action`

| 기능 | 권한 코드 | 설명 |
|------|----------|------|
| 목록 조회 | `resource:read` | 목록 조회 |
| 등록 | `resource:create` | 등록 |
| 수정 | `resource:update` | 수정 |
| 삭제 | `resource:delete` | 삭제 |

### 9.3 모듈/기능 코드
| 구분 | 코드 | 설명 |
|------|------|------|
| 모듈 | XX | 모듈명 |
| 기능 | XX-YYY | 기능명 |

## 10. UI 블록 계획
| 화면 | shadcn studio 블록 | 비고 |
|------|-------------------|------|

## 11. 재사용 컴포넌트
- [컴포넌트명]: [용도] - 공통 분리 권장

## 12. 확장 계획
- Phase 2 고려사항:
- 향후 통합:

## 13. 데이터 로드 및 인터랙션 정의

> **CRITICAL**: 개발자가 화면만 보고 짐작하지 않도록 데이터 로드 시점, 의존성, 예외 케이스를 명확히 기술합니다.

### 13.1 페이지 라이프사이클 (Page Lifecycle)

> 화면 진입 시점의 데이터 로드 흐름을 정의합니다.

#### [화면명] 데이터 로드 정의

**Page Load 시퀀스:**
```
1. 페이지 마운트
   │
   ├─▶ [API 1] 회사 목록 조회 (GET /companies)
   │   └── 조건: 로그인 사용자의 권한에 해당하는 회사만
   │   └── 정렬: 가나다순, 최근 접속 회사 우선
   │   └── 기본 선택: 첫 번째 회사 (또는 '전체')
   │
   ├─▶ [API 2] 역할 목록 조회 (GET /roles)
   │   └── 조건: 선택된 company_id 기준
   │   └── 의존성: 회사 선택 완료 후 호출
   │
   └─▶ [API 3] 메인 데이터 조회 (GET /items)
       └── 조건: company_id, role_id 파라미터 필수
       └── 의존성: 회사, 역할 선택 완료 후 호출
```

**데이터 의존성 매트릭스:**
| 데이터 | 선행 조건 | 병렬 로드 가능 | 캐시 정책 |
|--------|----------|---------------|----------|
| 회사 목록 | 없음 (페이지 진입) | ✓ | staleTime: 5분 |
| 역할 목록 | 회사 선택 | ✗ (회사 의존) | staleTime: 1분 |
| 메인 데이터 | 회사 + 역할 선택 | ✗ | staleTime: 30초 |

### 13.2 데이터 상태 정의 (State Definition)

> 각 데이터 로드 단계별 UI 상태를 정의합니다.

#### [화면명] 상태별 UI
| 상태 | 조건 | UI 표현 | 사용자 액션 |
|------|------|---------|------------|
| **Initial** | 데이터 로드 전 | Skeleton UI 표시 | 없음 (로딩 중) |
| **Loading** | API 호출 중 | Spinner + 이전 데이터 유지 | 액션 버튼 비활성화 |
| **Success** | 데이터 로드 완료 | 정상 UI 표시 | 모든 액션 가능 |
| **Empty** | 데이터 0건 | EmptyState 컴포넌트 | "등록" 버튼 표시 |
| **Error** | 로드 실패 | 에러 메시지 + "다시 시도" 버튼 | 재시도 클릭 시 재요청 |

### 13.3 인터랙션별 데이터 갱신

> 사용자 액션에 따른 데이터 변경 로직을 정의합니다.

#### [화면명] 인터랙션-데이터 매핑
| 사용자 액션 | 트리거 | API 호출 | 성공 시 데이터 처리 | 실패 시 처리 |
|-------------|--------|----------|-------------------|-------------|
| 회사 선택 | Select 변경 | GET /roles?company_id={id} | 역할 목록 갱신 + 메인 데이터 재조회 | Toast "역할 목록을 불러올 수 없습니다" |
| 검색 | Enter 또는 검색 버튼 | GET /items?search={keyword} | 목록 갱신 (필터 유지) | Toast "검색에 실패했습니다" |
| 필터 적용 | 필터 드롭다운 변경 | GET /items?filter={value} | 목록 갱신 (검색어 유지) | Toast "필터 적용에 실패했습니다" |
| 정렬 변경 | 컬럼 헤더 클릭 | GET /items?sort={column}&order={asc\|desc} | 목록 갱신 (필터/검색 유지) | - |
| 페이지 이동 | 페이지네이션 클릭 | GET /items?page={n} | 해당 페이지 데이터 표시 | Toast "데이터를 불러올 수 없습니다" |

### 13.4 비즈니스 규칙 (Business Rules)

> **IMPORTANT**: "데이터를 가져온다"만 적지 말고, 비즈니스 규칙을 한 줄 더 얹어주세요.

#### [화면명] 비즈니스 규칙
| 항목 | Bad (작성 금지) | Good (권장) |
|------|----------------|-------------|
| 목록 조회 | "회사 목록을 가져온다" | "최근에 접속했던 회사를 우선 표시하며, 가나다순으로 정렬. 기본 선택값은 첫 번째 회사" |
| 검색 | "검색한다" | "제품명, 제품코드, 담당자명으로 검색 가능. 대소문자 구분 없음. 2글자 이상 입력 시 자동 검색 (debounce 300ms)" |
| 정렬 | "정렬 가능" | "기본 정렬: 최신 등록순. 정렬 가능 컬럼: 등록일, 제품명, 수량, 상태. 다중 정렬 미지원" |
| 필터 | "필터링한다" | "상태 필터: 전체/진행중/완료/취소. 기간 필터: 오늘/이번 주/이번 달/직접 입력. 필터 조합 시 AND 조건" |

#### 구체적 비즈니스 규칙 예시:
```markdown
1. **회사 선택**
   - 조건: 로그인 사용자에게 권한이 부여된 회사만 표시
   - 정렬: 최근 접속 회사 우선 → 가나다순
   - 기본값: 마지막 접속 회사 (localStorage 저장) 또는 첫 번째 회사
   - 변경 시: 역할 목록 초기화 후 재조회, 메인 데이터 초기화

2. **목록 페이징**
   - 페이지당 표시 건수: 20건 (사용자 변경 가능: 10/20/50/100)
   - 총 건수 표시: "전체 {n}건 중 {start}~{end}건"
   - 1,000건 초과 시: 가상 스크롤 적용 권장

3. **검색 조건**
   - 최소 입력: 2글자 이상
   - 검색 대상 필드: 제품명, 제품코드, 담당자명
   - 검색 방식: 부분 일치 (LIKE '%keyword%')
   - 디바운스: 300ms
```

### 13.5 사용자 인터랙션 명세

#### [화면명] 인터랙션
| 액션 | 트리거 | 동작 상세 | 성공 시 | 실패 시 |
|------|--------|----------|---------|---------|
| 목록 조회 | 페이지 진입 | API 호출하여 데이터 로드 | 테이블에 데이터 표시 | "데이터를 불러올 수 없습니다" 토스트 |
| 검색 | 검색어 입력 후 Enter 또는 검색 버튼 클릭 | 검색 조건으로 필터링된 목록 조회 | 필터링된 결과 표시 | 결과 없음 메시지 표시 |
| 신규 등록 | "등록" 버튼 클릭 | Sheet 열림, 빈 폼 표시 | - | - |
| 수정 | 행의 "수정" 버튼 클릭 | Sheet 열림, 기존 데이터 로드 | 폼에 데이터 바인딩 | - |
| 삭제 | 행의 "삭제" 버튼 클릭 | 삭제 확인 Dialog 표시 | - | - |
| 삭제 확인 | Dialog에서 "삭제" 클릭 | 삭제 API 호출 | "삭제되었습니다" 토스트 + 목록 갱신 | "삭제에 실패했습니다" 토스트 |
| 폼 저장 | "저장" 버튼 클릭 | 유효성 검사 후 API 호출 | "저장되었습니다" 토스트 + Sheet 닫기 + 목록 갱신 | 필드별 에러 메시지 표시 |

### 13.6 상태 변경 로직

#### 상태 전이 다이어그램
```
[초기 상태]
    │
    ▼
┌─────────┐     등록 완료     ┌─────────┐
│  없음   │ ─────────────────▶│  대기   │
└─────────┘                   └─────────┘
                                   │
                                   │ 시작 버튼
                                   ▼
                              ┌─────────┐
                              │ 진행중  │
                              └─────────┘
                               │       │
                    완료 버튼  │       │ 취소 버튼
                               ▼       ▼
                          ┌─────────┐ ┌─────────┐
                          │  완료   │ │  취소   │
                          └─────────┘ └─────────┘
```

#### 상태별 가능한 액션
| 현재 상태 | 가능한 액션 | 불가능한 액션 |
|----------|------------|--------------|
| 대기 | 수정, 삭제, 시작 | 완료, 취소 |
| 진행중 | 완료, 취소 | 수정, 삭제, 시작 |
| 완료 | 조회만 | 수정, 삭제, 시작, 완료, 취소 |
| 취소 | 조회만 | 수정, 삭제, 시작, 완료, 취소 |

### 13.7 유효성 검사 규칙

#### 필드별 검증
| 필드명 | 검증 규칙 | 에러 메시지 | 검증 시점 |
|--------|----------|------------|----------|
| 제품명 | 필수, 1~100자 | "제품명을 입력해주세요" / "100자 이내로 입력해주세요" | blur, submit |
| 수량 | 필수, 양수, 정수 | "수량을 입력해주세요" / "1 이상의 숫자를 입력해주세요" | blur, submit |
| 예정일 | 필수, 오늘 이후 | "예정일을 선택해주세요" / "오늘 이후 날짜만 선택 가능합니다" | change, submit |
| 담당자 | 필수 | "담당자를 선택해주세요" | submit |

#### 복합 검증 (Cross-field Validation)
| 조건 | 검증 규칙 | 에러 메시지 |
|------|----------|------------|
| 시작일 & 종료일 | 종료일 >= 시작일 | "종료일은 시작일 이후여야 합니다" |
| 재고 & 수량 | 수량 <= 가용재고 | "가용 재고({재고량})를 초과할 수 없습니다" |

### 13.8 데이터 갱신 전략

| 이벤트 | 갱신 대상 | 갱신 방식 |
|--------|----------|----------|
| 등록 완료 | 목록 | invalidateQueries로 목록 재조회 |
| 수정 완료 | 목록 | invalidateQueries로 목록 재조회 |
| 삭제 완료 | 목록 | invalidateQueries로 목록 재조회 |
| 상태 변경 | 해당 행 | optimistic update 후 서버 확인 |
| 다른 화면에서 데이터 변경 | 목록 | 화면 진입 시 staleTime 기반 재조회 |

### 13.9 로딩 및 에러 상태

#### 로딩 상태
| 상황 | UI 표현 |
|------|---------|
| 초기 로딩 | 테이블 전체 Skeleton |
| 추가 로딩 (페이지네이션) | 하단 Spinner |
| 저장 중 | 버튼 disabled + Spinner 표시 |
| 삭제 중 | Dialog 버튼 disabled + Spinner |

#### 에러 상태
| 상황 | UI 표현 | 복구 방법 |
|------|---------|----------|
| 네트워크 에러 | Toast + 재시도 버튼 | 재시도 클릭 시 재요청 |
| 서버 에러 (500) | Toast "서버 오류가 발생했습니다" | 새로고침 안내 |
| 권한 에러 (403) | Toast "권한이 없습니다" | 이전 페이지로 이동 |
| 데이터 없음 | EmptyState 컴포넌트 | 등록 버튼 표시 |

### 13.10 엣지 케이스 및 예외 처리

| 케이스 | 상황 | 처리 방법 |
|--------|------|----------|
| 중복 등록 | 동일 데이터 중복 입력 | 서버에서 409 반환 → "이미 등록된 데이터입니다" 토스트 |
| 동시 수정 | 다른 사용자가 먼저 수정 | 서버에서 409 반환 → "다른 사용자가 수정했습니다. 새로고침하세요" |
| 긴 목록 | 1000건 이상 | 가상 스크롤 또는 페이지네이션 적용 |
| 세션 만료 | 토큰 만료 | 401 에러 시 로그인 페이지로 리다이렉트 |
| 폼 이탈 | 수정 중 페이지 이동 | "저장하지 않은 내용이 있습니다. 이동하시겠습니까?" 확인 Dialog |

### 13.11 키보드 단축키 및 접근성

| 단축키 | 동작 | 적용 범위 |
|--------|------|----------|
| Enter | 검색 실행 / 폼 저장 | 검색 필드 / 폼 |
| Escape | Sheet/Dialog 닫기 | 모달 |
| Tab | 다음 필드로 이동 | 폼 |
| Shift + Tab | 이전 필드로 이동 | 폼 |

## 14. 시퀀스 다이어그램 (선택)

> 데이터 흐름이 복잡할 때 사용자-프론트엔드-백엔드-DB 간 순서를 시각화합니다.

### 예시: 회사 선택 후 역할 목록 조회
```
사용자          프론트엔드              백엔드               DB
  │                 │                    │                  │
  │ 회사 선택       │                    │                  │
  │────────────────▶│                    │                  │
  │                 │ GET /roles?company_id=1              │
  │                 │───────────────────▶│                  │
  │                 │                    │ SELECT roles     │
  │                 │                    │─────────────────▶│
  │                 │                    │      결과        │
  │                 │                    │◀─────────────────│
  │                 │     역할 목록      │                  │
  │                 │◀───────────────────│                  │
  │  화면 갱신      │                    │                  │
  │◀────────────────│                    │                  │
```
```
